@using Haondt.Web.Core.Components
@using SpendLess.Components.SpendLessComponents
@model TransactionImportModel

<div class="box">
    <p class="subtitle">Import Transactions</p>
    <form hx-post="/_event/TransactionImportDryRun" hx-encoding="multipart/form-data">
        <div class="field">
            <label class="label">Input file</label>
            <div class="file">
              <label class="file-label">
                <input 
                    _="on change 
                        set files to the event's target.files
                        if files.length is 1
                            set file to files[0]
                            add .has-name to the closest .file
                            set (the next .file-name)'s innerHTML to the file's name
                            remove .is-hidden from the next .file-name
                        else
                            remove .has-name from the closest .file
                            add .is-hidden to the next .file-name
                        end
                        "
                    class="file-input" type="file" name="file" accept=".csv" />
                <span class="file-cta">
                  <span class="file-icon">
                    <i class="fas fa-upload"></i>
                  </span>
                  <span class="file-label"> Choose a file… </span>
                </span>
                <span class="file-name is-hidden"></span>
              </label>
            </div>
        </div>
        <div class="field">
          <label class="label">Account</label>
          <div class="control">
            <div class="select">
              <select name="account">
                @foreach(var account in Model.Accounts)
                {
                    <option value="@account.Key">@account.Value</option>
                }
              </select>
            </div>
          </div>
        </div>
        <div class="field" id="import-configuration-selection-field">
            <label class="label">Import Configuration</label>
            <div class="control buttons" >
                @if(Model.DefaultImportConfiguration.HasValue)
                {
                    <div class="select">
                        <select name="account">
                            @foreach(var (id, name) in Model.ImportConfigurations)
                            {
                                @if(id == Model.DefaultImportConfiguration.Value.Id)
                                {
                                    <option selected value="@id">@name</option>
                                }
                                else
                                {
                                    <option value="@id">@name</option>
                                }
                            }
                        </select>
                    </div>
                    <button class="button is-link is-outlined"
                        hx-post="/_event/TransactionImportEditConfiguration">
                        <span class="icon is-small">
                            <i class="fas fa-edit"></i>
                        </span>
                        <span>Edit</span>
                    </button>
                }
                @{var upsertModalTypeIdentity = ComponentDescriptor<UpsertTransactionImportConfigurationModalModel>.TypeIdentity; }
                <button class="button is-link is-outlined"
                    hx-get="/_component/@upsertModalTypeIdentity@(Model.DefaultImportConfiguration.HasValue ? "" : "?is-default=true")"
                    hx-swap="none">
                    <span class="icon is-small">
                        <i class="fas fa-plus"></i>
                    </span>
                    <span>Add New</span>
                </button>
          </div>
        </div>
        <hr/>
        <div id="preprocess-file-controls">
            <div class="field">
                <div class="control">
                    <button class="button is-primary">Preprocess File</button>
                </div>
            </div>
        </div>
    </form>
</div>

